{% comment %}
  Countdown Timer Section
{% endcomment %}

<section class="countdown-section py-20 bg-red-500 text-white" data-section-id="{{ section.id }}">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
    
    {% if section.settings.heading != blank %}
      <h2 class="text-2xl mb-2">{{ section.settings.heading }}</h2>
    {% endif %}
    
    {% if section.settings.subheading != blank %}
      <p class="text-white/90 mb-8">{{ section.settings.subheading }}</p>
    {% endif %}

    <div class="countdown-timer flex justify-center gap-4 md:gap-8 mb-8" 
         data-countdown 
         data-end-date="{{ section.settings.end_date }}">
      <div class="countdown-item">
        <div class="countdown-number bg-white/10 backdrop-blur-md rounded-lg p-4 md:p-6 min-w-[80px]">
          <span class="text-2xl md:text-4xl block" data-days>00</span>
        </div>
        <span class="text-xs md:text-sm mt-2 block uppercase tracking-wider">Días</span>
      </div>
      <div class="countdown-item">
        <div class="countdown-number bg-white/10 backdrop-blur-md rounded-lg p-4 md:p-6 min-w-[80px]">
          <span class="text-2xl md:text-4xl block" data-hours>00</span>
        </div>
        <span class="text-xs md:text-sm mt-2 block uppercase tracking-wider">Horas</span>
      </div>
      <div class="countdown-item">
        <div class="countdown-number bg-white/10 backdrop-blur-md rounded-lg p-4 md:p-6 min-w-[80px]">
          <span class="text-2xl md:text-4xl block" data-minutes>00</span>
        </div>
        <span class="text-xs md:text-sm mt-2 block uppercase tracking-wider">Minutos</span>
      </div>
      <div class="countdown-item">
        <div class="countdown-number bg-white/10 backdrop-blur-md rounded-lg p-4 md:p-6 min-w-[80px]">
          <span class="text-2xl md:text-4xl block" data-seconds>00</span>
        </div>
        <span class="text-xs md:text-sm mt-2 block uppercase tracking-wider">Segundos</span>
      </div>
    </div>

    {% if section.settings.button_text != blank %}
      <a href="{{ section.settings.button_link }}" class="inline-block bg-white text-red-500 px-8 py-3 rounded-lg hover:bg-gray-100 transition-colors">
        {{ section.settings.button_text }}
      </a>
    {% endif %}

  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const countdownElements = document.querySelectorAll('[data-countdown]');
    
    countdownElements.forEach(function(element) {
      const endDate = new Date(element.dataset.endDate).getTime();
      
      const daysEl = element.querySelector('[data-days]');
      const hoursEl = element.querySelector('[data-hours]');
      const minutesEl = element.querySelector('[data-minutes]');
      const secondsEl = element.querySelector('[data-seconds]');
      
      function updateCountdown() {
        const now = new Date().getTime();
        const distance = endDate - now;
        
        if (distance < 0) {
          daysEl.textContent = '00';
          hoursEl.textContent = '00';
          minutesEl.textContent = '00';
          secondsEl.textContent = '00';
          return;
        }
        
        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);
        
        daysEl.textContent = String(days).padStart(2, '0');
        hoursEl.textContent = String(hours).padStart(2, '0');
        minutesEl.textContent = String(minutes).padStart(2, '0');
        secondsEl.textContent = String(seconds).padStart(2, '0');
      }
      
      updateCountdown();
      setInterval(updateCountdown, 1000);
    });
  });
</script>

{% schema %}
{
  "name": "Countdown Timer",
  "tag": "section",
  "class": "countdown-timer-section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Oferta por tiempo limitado"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "¡No te lo pierdas!"
    },
    {
      "type": "text",
      "id": "end_date",
      "label": "End Date",
      "info": "Format: YYYY-MM-DD HH:MM:SS (e.g., 2025-12-31 23:59:59)",
      "default": "2025-12-31 23:59:59"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Comprar ahora"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button Link"
    }
  ],
  "presets": [
    {
      "name": "Countdown Timer"
    }
  ]
}
{% endschema %}
